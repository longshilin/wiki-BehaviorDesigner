# 什么是一个行为树？
行为树是一个运用在很多游戏中很流行的AI技术。Halo 2是第一个使用行为树的主流游戏，在发布了有关它们在Halo 2中的用法的 [详细说明](http://www.gamasutra.com/view/feature/130663/gdc_2005_proceeding_handling_.php) 之后，它们开始变得越来越流行。行为树是许多不同AI技术的组合：分层状态机，调度，计划和动作执行。它们的主要优点之一是易于理解，并且可以使用可视编辑器创建。 

![](https://cdn.jsdelivr.net/gh/longshilin/images/20201108214126.png)

在最简单的级别上，行为树是任务的集合。任务有四种不同类型：动作，条件，复合和装饰器。动作任务可能是最容易理解的，因为它们以某种方式改变了游戏的状态。条件任务测试游戏的某些属性。例如，在上面的树中，AI代理具有两个条件任务和两个动作任务。前两个条件任务检查以查看特工眼中是否有敌人，然后确保特工具有足够的子弹来发射武器。如果这两个条件都成立，则将执行两个操作任务。一项动作任务是射击武器，另一项任务是播放动画。当您形成不同的子树时，行为树的真正力量就会发挥作用。这两个射击动作可以形成一棵子树。如果较早的条件任务之一失败，则可以制作另一棵子树，该子树扮演一组不同的动作任务，例如逃避敌人。您可以将子树彼此分组以形成高级行为。

复合任务是一个**父任务**，其中包含一系列子任务。从上面的示例中，组合任务被标记为顺序和并行。序列任务将每个任务运行一次，直到所有任务都已运行。它首先运行条件任务，以检查敌人是否在视线范围内。如果敌人在视线范围内，它将执行条件任务，以检查特工是否还有子弹。如果特工有足够的子弹，则将运行并行任务，以射击武器并播放射击动画。在顺序任务一次执行一个子任务的情况下，并行任务同时执行其所有子项的任务。

任务的最后一种类型是装饰器任务。装饰器任务是一个父任务，只能有一个孩子。它的功能是以某种方式修改子任务的行为。在上面的示例中，我们没有使用装饰器任务，但是如果要停止某项任务过早运行（称为中断任务），则可能要使用装饰任务。例如，代理可能正在执行诸如收集资源之类的任务。然后可能会有一个中断任务。 10个将在附近有敌人的情况下停止收集资源。装饰器任务的另一个示例是重新运行其子任务x次数的装饰器任务，或者是一个装饰器任务，其继续运行子任务直到成功完成。到目前为止，我们遗漏的主要行为树主题之一是任务的返回状态。您可能需要完成一个以上的任务。例如，大多数动画都不会在一帧之内开始和结束。

另外，条件任务需要一种方法来告诉其父任务条件是否为真，以便父任务可以决定是否应继续运行其子级。使用任务状态可以解决这两个问题。任务处于三种不同状态之一：运行，成功或失败。在第一个示例中，只要播放动画，拍摄动画任务的任务状态就会一直运行。确定敌人是否在视线范围内的条件任务将在一帧之内返回成功或失败。

行为设计器采用了所有这些概念，并将其打包在一个易于使用的界面中，并使用类似于Unity的MonoBehaviour API的API。行为设计器在标准安装中包括许多复合和装饰类。动作和条件任务是特定于游戏的，因此没有包括很多任务，但[示例项目](https://opsive.com/integrations/?pid=803)中有许多示例。可以通过从一种任务类型[扩展](https://opsive.com/support/documentation/behavior-designer/writing-a-new-conditional-task/)来创建新任务。另外，已经创建了许多视频，以使学习Behavior Designer变得尽可能容易。


